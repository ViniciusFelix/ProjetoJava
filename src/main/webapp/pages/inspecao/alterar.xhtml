<?xml version="1.0" encoding="ISO-8859-1" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui" xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets" template="/template/default.xhtml"
	xmlns:pe="http://primefaces.org/ui/extensions">
	<ui:define name="content">
	<script>
		function verificaExisteDel(){
			
			var valorCampoHidden;
			valorCampoHidden = document.getElementById('campoVerifica').value;

			if(valorCampoHidden > 0){
					PF('DlgformDialogEmail').show();
					return false;
				} else {
					return true;
				}
				
			}
		
	</script>
		<f:view>
		<p:chart type="pie" model="#{inspecaoBean.pieModel1}" style="width:400px;height:300px" />
		<p:panel id="botoes">
			<p:commandButton onclick="if(!verificaExisteDel()){ return false; }"
				action="#{inspecaoBean.publicarPje}" value="Inspeção publicada no Pje"/>
				
			<p:commandButton onclick="if(!verificaExisteDel()){ return false; }"
				action="#{inspecaoBean.publicarPje}" value="Achados / Determinações"/>
		</p:panel>
			<h:form id="form" prependId="false" enctype="multipart/form-data">
				<p:panel id="panelAlterar" header="Alterar">
					<h:panelGrid columns="2" columnClasses="columnNome, columnSelect">
						
						<h:outputText 
							value="#{messages['inspecao.tipoInspecao']}" />
						<p:selectOneRadio
							value="#{inspecaoBean.inspecao.tipoInspecao}" label="Tipo" required="true" disabled="true">
							<f:selectItem itemLabel="Correição" itemValue="C" />  
	           				<f:selectItem itemLabel="Inspeção" itemValue="I" /> 
						</p:selectOneRadio>
						
						<h:outputText 
							value="Número" />
						<p:inputText value="#{inspecaoBean.inspecao.numInspecao}/#{inspecaoBean.inspecao.numAnoInspecao}" disabled="true" />
	
						<h:outputText
							value="#{messages['inspecao.tipoObjeto']}"/>
						<p:selectManyCheckbox
							converter="#{tipoObjetoAplicacaoConverter}"
							id="lineDirection"
							value="#{inspecaoBean.tipoObjetoAplicacaoListSelected}"
							label="Tipo de Objeto">
 							<f:selectItems 
								value="#{inspecaoBean.allTipoObjetoAplicacao}"
								var="tipoObjetoAplicacao"
								itemLabel="#{tipoObjetoAplicacao.dscTipoObjetoAplicacao}"
								itemValue="#{tipoObjetoAplicacao}"
								>
							</f:selectItems>
						</p:selectManyCheckbox>
				
					</h:panelGrid>
				</p:panel>
				<p:panel id="panelDadosInspecao" header="Dados da inspeção" style="">
					<table>
						<tr>
							<td>
								<h:outputText value="Portaria" />
							</td>
							<td>
								<p:inputMask
									value="#{inspecaoBean.inspecao.numPortaria}"
									required="true" label="Portaria" mask="999/9999" />
							</td>
							<td>
								<h:outputText value="Nº Processo" /> 
							</td>
							<td colspan="3">
								<p:inputMask
									value="#{inspecaoBean.inspecao.numProcessoPje}"
									label="Número do processo" mask="9999999-99.9999.9.99.9999" style="width:200px"/>
							</td>
						</tr>
					</table>
					<table>
						<tr>
							<td>
								<h:outputText value="Período" />
							</td>
							<td>
								<p:calendar locale="pt_BR" id="inicio"
									value="#{inspecaoBean.inspecao.datInicioInspecao}"
									required="true" label="Data de início da inspeção">
								</p:calendar>
							</td>
							<td>
								<h:outputText value="até" />
							</td>
							<td>
								<p:calendar locale="pt_BR" id="fim"
									value="#{inspecaoBean.inspecao.datFinalInspecao}"
									required="true" label="Data final da inspeção">
								</p:calendar>
							</td>
						</tr>
					</table>
					
					<p:tabView id="abas" activeIndex="#{inspecaoBean.activeTabIndex}">  
					
						<p:tab id="judicial" title="Órgãos judiciais" >
						
						    <h:panelGrid columns="2">
						    	<h:outputText value="Esfera judiciária:" /> 						        
							        <p:selectOneMenu id="esfera" value="#{inspecaoBean.esfera.id}">  
								        <f:selectItem itemLabel="Escolha uma esfera" itemValue="" />
								        <f:selectItem itemLabel="Justiça estadual" itemValue="TRIBE" /> 
								        <f:selectItem itemLabel="Justiça federal" itemValue="TRIBF" /> 
								        <f:selectItem itemLabel="Justiça eleitoral" itemValue="TRIBL" /> 
								        <f:selectItem itemLabel="Justiça trabalhista" itemValue="TRIBT" />
								        <f:selectItem itemLabel="Justiça militar" itemValue="TRIBM" />   
								        <p:ajax update="tribunais "
	                         					listener="#{inspecaoBean.allByEsfera}" />
						        </p:selectOneMenu>
						        
						        <h:outputText value="Orgãos:" />
								<p:tree id="tribunais" value="#{inspecaoBean.rootJudicial}" var="node" dynamic="true" cache="true"
							   		style="width: 500px;height:300px;overflow:scroll;"
						            selectionMode="checkbox"  >  
						            
						            <p:ajax event="expand" listener="#{inspecaoBean.onNodeExpand}" update="@this"/>
						            <p:ajax event="select" listener="#{inspecaoBean.preencheUnidadesSelected}" />
						            <p:ajax event="unselect" listener="#{inspecaoBean.despreencheUnidadesSelected}" />
							  		
							        <p:treeNode>  
							       		<h:outputText value="#{node}" />
							        </p:treeNode>
							     </p:tree>
									
							</h:panelGrid>
							
					    </p:tab>  
					
					    <p:tab id="extrajudicial" title="Órgãos extrajudiciais">  
					        <h:panelGrid columns="2">
						        <h:outputText value="Estado" /> 						        
						        <p:selectOneMenu id="uf" value="#{inspecaoBean.uf.uf}">  
						            <f:selectItem itemLabel="Escolha um estado" itemValue="" />  
					            	<f:selectItems value="#{inspecaoBean.allEstados}"
										var="estados"
										itemLabel="#{estados.uf}"
										itemValue="#{estados.uf}" />
										<p:ajax update="listaCartorios "
                         					listener="#{inspecaoBean.allByUF}" />
					            </p:selectOneMenu>
						   </h:panelGrid>     
						   
					       <h:outputText value="Cartório:" />
						   <p:tree id="listaCartorios" value="#{inspecaoBean.rootExtrajudicial}" var="node"  dynamic="true" cache="true"
						   		style="width: 500px;height:300px;overflow:scroll;"
					            selectionMode="checkbox"  >  
					            
					            <p:ajax event="select" listener="#{inspecaoBean.preencheCartorioSelected}" />
					            <p:ajax event="unselect" listener="#{inspecaoBean.despreencheCartorioSelected}" />
						  		
						        <p:treeNode>  
						       		<h:outputText value="#{node}" />
						        </p:treeNode>
						   </p:tree>
					        
					    </p:tab>
					</p:tabView> 
					
					<br></br>
										
				</p:panel>
				
				<p:panel id="panelPalavraChave" header="Palavras-chave" style="">
					<h:panelGrid>
						<p:inputTextarea
							value="#{inspecaoBean.inspecao.dscAssunto}" width="900"
							label="Palavras-chave" cols="177" />
					</h:panelGrid>
				</p:panel>
				
				<p:panel id="introducao" header="Introdução" style="">
					<h:panelGrid>
					<p:editor id="introducaoEditor" widgetVar="introducao" value="#{inspecaoBean.inspecao.dscIntroducao}" width="900" />
					</h:panelGrid>
				</p:panel>

				<p:panel id="conclusao" header="Conclusão" style="">
					<h:panelGrid>
					<p:editor id="conclusaoEditor" widgetVar="conclusao" value="#{inspecaoBean.inspecao.dscConclusao}" width="900" />
					</h:panelGrid>
				</p:panel>
				
				<p:panel id="panelAnexarDocumentos" header="Anexar documentos" style="">
				
					<h:panelGrid columns="2" id="formGridAnexarDocumentos">
						<h:outputText value="Tipo documento" />
				        <p:selectOneMenu id="tipoDocumento" value="#{inspecaoBean.documento.tipoDocumento}" converter="#{tipoDocumentoConverter}">  
				            <f:selectItem itemLabel="Selecione o tipo documento" itemValue="" />
				            <f:selectItems value="#{tipoDocumentoBean.all}"
								var="tipoDocumento"
								itemLabel="#{tipoDocumento.dscTipoDocumento}"
								itemValue="#{tipoDocumento}" />
						 </p:selectOneMenu>	
						 
						 <h:outputLabel value="Descrição " for="txt_title"></h:outputLabel>  
			             <p:inputText id="txt_title"   
			             	value="#{inspecaoBean.documento.nomeArquivo}" style="width: 400px"/>  
						 <h:outputText value="Arquivo" />
						 <p:fileUpload id="fileupload"
						 	  fileUploadListener="#{inspecaoBean.handleFileUpload}"
						 	  auto="true"
						 	  dragDropSupport="true"
					 	 	  update="nomeArquivo"
					 	 	  allowTypes="/(\.|\/)(gif|jpe?g|png|doc|docx|xls|xlsx|pps|ppsx|ppt|pptx|pdf)$/"
	                          label="Procurar..." cancelLabel="Cancelar"
	                          fileLimit="1"
	                          sizeLimit="5242880"
	                          invalidFileMessage="Formato de arquivo inválido."
	                          invalidSizeMessage="Tamanho do arquivo inválido (máximo permitido de 5MB)."
	                          fileLimitMessage="Apenas um arquivo por vez." /> 
	                          <h:outputText value="Arquivo selecionado" />
	               			  <h:outputText id="nomeArquivo" value="#{inspecaoBean.documento.urlArquivo}" />
	               			  
	               		<f:facet name="footer"> 
	               			<div align="center">
								<p:commandButton value="Adicionar" action="#{inspecaoBean.montaListaDocumento}" update="arquivoSelecionado,formGridAnexarDocumentos @parent" process="formGridAnexarDocumentos" />
		                		<p:commandButton value="Limpar" update="nomeArquivo" immediate="true" action="#{inspecaoBean.limpaUrlArquivo}"/>
                			</div>
                			<br />
                			<br />
                		</f:facet>
                		
					</h:panelGrid>
					
					<p:dataTable var="documentos" value="#{inspecaoBean.inspecao.documentos}"
						emptyMessage="Não foram encontrados registros."
						id="arquivoSelecionado">  
				        <p:column headerText="Tipo Documento">  
				            <h:outputText value="#{documentos.tipoDocumento.dscTipoDocumento}" />  
				        </p:column>  
				  
				        <p:column headerText="Descrição">  
				            <h:outputText value="#{documentos.nomeArquivo}" />  
				        </p:column>  
				        
				        <p:column headerText="URL Arquivo">  
				            <h:commandLink target="blank" value="#{documentos.urlArquivo}"  action="#{inspecaoBean.recuperarArquivo}">  
				            	<f:setPropertyActionListener
										target="#{inspecaoBean.documento}"
										value="#{documentos}" />
				            </h:commandLink>
				        </p:column>  

				        <p:column>  
			                <f:facet name="header">  
			                    <h:outputText value="Ação" />  
			                </f:facet>  
			                <p:commandLink value="Remover" onclick="PF('confirmationDoc#{documentos.id}').show()"/>
			                <p:confirmDialog  message="Deseja realmente excluir este registo?" closable="false" header="Aviso" severity="alert" widgetVar="confirmationDoc#{documentos.id}">  
						    	<p:commandButton id="btnSim" value="Sim" onclick="confirmationDoc#{documentos.id}.hide()" update="arquivoSelecionado" process="@this" action="#{inspecaoBean.removerArquivo}">
						    		<f:setPropertyActionListener
										target="#{inspecaoBean.documento}"
										value="#{documentos}" />
						    	</p:commandButton>
						        <p:commandButton id="btnNao" value="Não" onclick="confirmationDoc#{documentos.id}.hide()" type="button"/>  
							</p:confirmDialog>
			            </p:column>
				    </p:dataTable> 
				
				</p:panel>
				<br></br>
				<div align="center">
					<p:commandButton
						action="#{inspecaoBean.alterarInspecao}" value="Alterar" icon="ui-icon-check"/>
						
				</div>
				
				<p:dialog header="E-mail" id="DlgformDialogEmail" widgetVar="DlgformDialogEmail" resizable="true">
						<h:panelGrid columns="2" style="margin-bottom:10px;" id="formRes">
							<h:outputLabel for="email" value="E-mail" />
				  		<div align="center">
				  			<span>
				        		<p:commandButton action="#{inspecaoBean.publicarPje}" value="Salvar"/>
				        	</span>  
				        </div>
						</h:panelGrid>
				</p:dialog>
				
			</h:form>
	
		</f:view>
	

	</ui:define>

</ui:composition>